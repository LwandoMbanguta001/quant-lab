---
author: |
  - |
    Mbanguta Lwando
date: "`r format(Sys.time(), '%B %d, %Y')`"
output:
  pdf_document:
    latex_engine: xelatex
classoption: notitlepage
geometry: margin=1in
header-includes:
  - "\\usepackage{graphicx}"
  - \usepackage{pdfpages}
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Lesson 1: Financial Derivatives Basics

to compute the binomial tree, need input data:

  i) upward movement (u),
  
  ii) downward movement (d),
  
  iii) risk-free rate ($r_f$),
  
  iv) time-horizon (T), and
  
  v) number of steps in the tree (N)
  
These are all user-inputs to the function.

To get different number of steps (or time-horizon) for evolution of underlying, use time-step for binomial model,
$$dt = \frac{T}{N}$$
  
NB: This is useful for calculation of risk-neutral probabilities.

### Constructing a Binomial Tree

Can simulate the underlying stock price with inputs:
initial stock price; time-horizon (T), upward (u), and downward (d) movements, and number of steps (N).

The return variable (output) contains an array of stock price values at each point in time in a lower triangular matrix.

\begin{center}
\includegraphics[width=10cm, height=3cm]{"C:/Catapult Programme/Training/Msc FE/MScFE 620 Derivative Pricing/Images/Im1.png"}
\end{center}

### Extending the Tree with Call Option Payoffs

On the inputs, can add a strike price (K).

The additional output variable will contain call option payoff at maturity.

### Introducing Risk-Neutral Probabilities and backward induction of Call Option Value

With observed probabilities, through backward induction, can calculate the value of the call option (given its future payoffs and associate probabilities) at each node.

Once risk-neutral probabilities are known, the value of call option at each node will depend on the expected payoff in the two potential future scenarios (i.e. up or down movements) discounted at risk-free rate.

That is,
$$C_t = e^{-r \times dt}[p \times c^u_{t+1} + (p-1)\times c^d_{t+1}]$$
where $dt$ - discounted period from one node to the next (time-step);
$c^u_{t+1}$ & $c^d_{t+1}$ - values of call option in next period.

Thus have to start from last period (maturity) and work backwards, hence backward induction.

$dt$ is used as we're assuming there are a bunch of periods (steps) in the tree from the initial date until maturity of the option.

In 1-step case, can calculate risk-neutral probabilities as $dt = \frac{T}{N} = \frac{1}{1}=T$:

$$p = \frac{e^{r \times T}-d}{u-d}$$

When $dt$ is different, need to modify $p$:
$$p = \frac{e^{r \times dt}-d}{u-d}$$

Since its backward induction, the first value of call option payoff matrix is the price of the call option today.

Reminder: Payoffs

i) Call Option = $(S_t - K)^+ = \max(S_t - K; 0)$

ii) Put Option = $(K-S_t)^+ = \max(K- S_t ; 0)$

\newpage

# Lesson 2: Option Pricing and Put-Call Parity

### Put-Call Parity in Binomial Tree

To satisfy the absence of arbitrage conditions, the relationship between the price of put and call options must be:

$$C_0 + K \times e^{-r \times T} = S_0 + P_0$$

# Lesson 3: Delta and Delta Hedging

### Delta Hedging in Binomial Tree

For simplicity, assume risk-free rate $r=0$ and want to price a call option with strike price, $K=90$.

After defining a function to price a European call option using a binomial tree methodology, it'd return the evolution of underlying asset $S_t$, the price of call option at each node of tree $C_t$, and $\Delta_t$ (number of shares in terms of exposure) in each node of the tree.

Thus, to hedge the sale of call option (as we're selling this as a bank), we need to do the following:

  i) At $t=0$, buy $\Delta_0$ shares.
  
  ii) At $t=1$, hold $\Delta_1^d$ shares if are "down" or $\Delta_1^u$ if are "up".

That is,

  i) At $t=0$, buy $\Delta_0$ shares at $C_0$ per share.
  
  ii) At $t=1$, if are "down" sell  $\Delta_0 - \Delta_1^d$ shares at $C_1$ per share.

### Generalization to any N

NB: With a higher N, the call price will increase monotonically. 

Below is convergence of price of option for different N's.

\begin{center}
\includegraphics[width=10cm, height=6cm]{"C:/Catapult Programme/Training/Msc FE/MScFE 620 Derivative Pricing/Images/Im2.png"}
\end{center}

Thus, the maximum value of the call price must be the underlying price.

\newpage

# Lesson 4: Matching Volatility and Risk-Measures

### Adjusting u and d for Underlying Volatility

Adjust inputs $u$ and $d$ to match underlying volatility, which leads to:

$$u = e^{\sigma \times \sqrt{dt}} \hspace{10pt} \text{and} \hspace{10pt} d= e^{-\sigma \times \sqrt{dt}}$$

NB: Assuming underlying stock volatility for next period is known.

Thus, as N increases, the call option price converges.

\begin{center}
\includegraphics[width=10cm, height=6cm]{"C:/Catapult Programme/Training/Msc FE/MScFE 620 Derivative Pricing/Images/Im3.png"}
\end{center}

### Obtain sigma

Now, we'll obtain the volatility of underlying asset to calibrate the model.

There are alternatives, that is:

  i) Historical asset volatility - but this relies on the past data (which is not good).
  
  ii) Implied asset volatility - implied by exchange-traded option prices.
  
If we have an exchange-traded option (for which the price is set by supply and demand) and a pricing equation that depends on parameters (including  $\sigma$), can resolve this equation and extract the volatility implied by that price.
